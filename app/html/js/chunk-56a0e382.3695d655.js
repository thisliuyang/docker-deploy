(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56a0e382"],{"096f":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("basic-container",[r("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[r("el-collapse-item",{attrs:{title:"登记信息",name:"1"}},[r("avue-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{option:e.option},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1),r("el-collapse-item",{attrs:{title:"卖方信息",name:"1"}},[r("avue-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"sellerinfoForm",attrs:{option:e.sellerinfoOption},scopedSlots:e._u([{key:"sellerName",fn:function(t){var n=t.disabled;return[r("div",{staticClass:"sellerName"},[r("el-input",{attrs:{placeholder:"请输入卖方名称",disabled:n},model:{value:e.sellerinfoForm.sellerName,callback:function(t){e.$set(e.sellerinfoForm,"sellerName",t)},expression:"sellerinfoForm.sellerName"}}),1===e.form.declareType&&!n&&"admin-edit"!==e.type||1==e.isClassified?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleUnit("sellerinfoForm")}}},[e._v("选择单位自动填充信息")]):e._e()],1)]}}]),model:{value:e.sellerinfoForm,callback:function(t){e.sellerinfoForm=t},expression:"sellerinfoForm"}})],1),r("el-collapse-item",{attrs:{title:"买方信息",name:"2"}},[r("avue-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"buyerinfoForm",attrs:{option:e.buyerinfoOption},scopedSlots:e._u([{key:"buyerName",fn:function(t){var n=t.disabled;return[r("div",{staticClass:"buyerName"},[r("el-input",{attrs:{placeholder:"请输入买方名称",disabled:n},model:{value:e.buyerinfoForm.buyerName,callback:function(t){e.$set(e.buyerinfoForm,"buyerName",t)},expression:"buyerinfoForm.buyerName"}}),2===e.form.declareType&&!n&&"admin-edit"!==e.type||1==e.isClassified?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleUnit("buyerinfoForm")}}},[e._v("选择单位自动填充信息")]):e._e()],1)]}}]),model:{value:e.buyerinfoForm,callback:function(t){e.buyerinfoForm=t},expression:"buyerinfoForm"}})],1),r("el-collapse-item",{attrs:{title:"合同信息",name:"3"}},[r("avue-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"contractinfoForm",attrs:{option:e.contractinfoOption,"upload-exceed":e.uploadExceed,"upload-delete":e.uploadDelete,"upload-preview":e.uploadPreview,"upload-error":e.uploadError},on:{error:e.error},model:{value:e.contractinfoForm,callback:function(t){e.contractinfoForm=t},expression:"contractinfoForm"}},[r("template",{slot:"contractTypeChild"},[r("div",{staticClass:"contractTypeChild"},[r("el-tag",[e._v(e._s(e.form.$contractType?e.form.$contractType:"未选择合同类型"))]),r("avue-select",{attrs:{placeholder:"请选择合同类型小分类",type:"tree","no-data-text":"请先在登记信息中选择合同类型",props:{label:"dictValue",value:"dictKey"},dic:e.dicData},model:{value:e.contractinfoForm.contractTypeChild,callback:function(t){e.$set(e.contractinfoForm,"contractTypeChild",t)},expression:"contractinfoForm.contractTypeChild"}})],1)])],2)],1)],1),"detail"!=e.type?r("div",{staticClass:"btn-list"},[r("el-button",{attrs:{loading:e.loading},on:{click:e.handleCancel}},[e._v("\n      取消\n    ")]),r("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSave}},[e._v("\n      "+e._s(e.form&&1==e.form.contractStatus?"暂存":"保存")+"\n    ")]),e.form&&1==e.form.contractStatus&&"admin-edit"!==e.type?r("el-button",{attrs:{icon:"el-icon-check",type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("\n      提交\n    ")]):e._e(),this.taskId&&this.processInstanceId?r("el-button",{attrs:{icon:"el-icon-check",type:"primary",loading:e.loading},on:{click:e.handleEditSubmit}},[e._v("\n      调整后提交\n    ")]):e._e(),e.form&&1==e.form.contractStatus&&e.isDev?r("el-button",{attrs:{type:"info",loading:e.loading},on:{click:function(t){return e.handleSubmit(1)}}},[e._v("\n      无验证测试提交（测试用）\n    ")]):e._e()],1):e._e(),r("el-dialog",{directives:[{name:"dialogdrag",rawName:"v-dialogdrag"}],staticClass:"avue-dialog",attrs:{title:"选择单位",visible:e.unitListIsShow,width:"70%","append-to-body":""},on:{"update:visible":function(t){e.unitListIsShow=t}}},[e.unitListIsShow?r("unitTable",{on:{select:e.handleSelect}}):e._e(),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.unitListIsShow=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.unitListIsShow=!1}}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"申请认定登记需要注意的事项：","append-to-body":"",visible:e.tipsVisible},on:{"update:visible":function(t){e.tipsVisible=t}}},[r("div",{staticClass:"title-tips"},[r("p",[e._v("\n        1、请选择正确的行政区划，行政区划选择错误可退出在线业务办理界面重新选择。\n      ")]),r("p",[e._v("\n        2、技术转让、技术许可、技术开发合同金额大于等于500万，技术咨询、技术服务合同金额大于等于1000万的为大额合同。大额和涉外技术合同认定登记选择行政区划时需选择湖北省科技厅。\n      ")]),r("p",[e._v("\n        3、技术转让、技术许可、技术开发合同及技术服务、技术咨询金额大于500万以上,需上传相应的合同凭证。\n      ")]),r("p",[e._v("\n        4、技术合同登记信息通过省级管理员审核通过后，符合免税申请条件的合同可申请免税流程。\n      ")]),r("p")]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.tipsVisible=!1}}},[e._v("确 定")])],1)])],1)},i=[],a=(r("8e6e"),r("28a5"),r("b54a"),r("6b54"),r("87b3"),r("456d"),r("5df3"),r("7514"),r("c5f6"),r("7f7f"),r("96cf"),r("3b8d")),o=r("bd86"),s=(r("6762"),r("2fdb"),r("ac6a"),r("c832")),l=r.n(s),c=r("799f"),u=r("c0c7"),d=r("6044"),p=r("738e"),f=r("1e69"),h=r("0e0b"),m=r("fcb7"),b=r("8ddc"),y=r("5a04"),g=r("2f62"),v=r("207b");function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O={name:"Contract",components:{unitTable:v["default"]},data:function(){var e=this,t=function(t,r,n){""===r?n(new Error("成交总金额必须填写")):(e.contractinfoForm.turnover&&e.$refs.contractinfoForm.validateField("turnover"),n())},r=function(t,r,n){""===r?n(new Error("请其中技术交易额")):r>e.contractinfoForm.contractTotalAmount?n(new Error("技术交易额不能大于合同总金额")):n()};return{unitInfo:{},isDev:!1,activeNames:["1","2","3"],sellerinfoOption:{detail:!1,disabled:!1,readonly:!0,labelPosition:"right",labelSuffix:"：",labelWidth:220,gutter:0,menuBtn:!0,submitBtn:!1,emptyBtn:!1,emptyText:"清空",menuPosition:"center",column:[{type:"input",label:"卖方名称",span:18,display:!0,disabled:!1,prop:"sellerName",rules:[{required:!0,message:"请填写卖方名称"}]},{type:"tree",label:"卖方国别",span:12,display:!0,parent:!1,prop:"sellerCountry",dicData:[],props:{label:"dictValue",value:"dictKey"},required:!0,rules:[{required:!0,message:"请选择项目卖方国别"}]},{type:"input",label:"邮政编码",span:12,display:!0,prop:"spostalCode",rules:[{required:!0,message:"邮政编码必须填写"}]},{label:"卖方性质",type:"tree",span:12,display:!0,parent:!1,disabled:!1,props:{label:"dictValue",value:"id"},dataType:"string",dicData:[],cascaderItem:[],prop:"sellerNature",rules:[{required:!0,message:"卖方性质必须填写"}],change:function(t){var r=t.value,n=l()(e,"$refs.sellerinfoForm.DIC.sellerNature"),i=Object(h["e"])(n,r,"id",[]),a="110"!==l()(i,"[0]");["sellerIndustry"].forEach((function(t){var r=e.findObject(e.sellerinfoOption.column,t);r.rules[0].required=a,r.disabled=!a,a?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.sellerinfoForm[t]=null,e.$refs.sellerinfoForm&&e.$refs.sellerinfoForm.validateField(t))}))}},{type:"input",label:"社会统一信用代码",span:12,display:!0,prop:"sorganizationCode",rules:[{required:!0,message:"社会统一信用代码必须填写"}]},{type:"tree",label:"卖方地区",parent:!1,dicData:[],props:{label:"title",value:"value"},cascaderItem:[],span:12,display:!0,prop:"sellerRegion",rules:[{required:!0,message:"请选择卖方地区"}]},{type:"input",label:"注册地址",span:12,display:!0,prop:"sellerAddress",rules:[{required:!0,message:"注册地址必须填写"}]},{type:"select",label:"机构从事的国民经济行业",dicData:[],props:{label:"dictValue",value:"id"},cascaderItem:[],span:12,display:!0,prop:"sellerIndustry",rules:[{required:!0,message:"机构从事的国民经济行业必须填写"}]},{type:"select",label:"企业规模",dicUrl:"/api/blade-system/dict-biz/dictionary?code=corpScale",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"senterpriseScale",rules:[{required:!0,message:"请选择企业规模"}]},{type:"input",label:"法人代表",span:12,display:!0,prop:"slegalRepresentative",rules:[{required:!0,message:"法人代表必须填写"}],required:!0},{type:"input",label:"联系人",span:12,display:!0,prop:"sellerContact",required:!0,rules:[{required:!0,message:"联系人必须填写"}]},{type:"input",label:"联系电话",span:12,display:!0,prop:"phone",rules:[{required:!0,message:"联系电话必须填写"}],required:!0},{type:"input",label:"电子邮件",span:12,display:!0,prop:"sellerEmail",rules:[{required:!1,message:"电子邮件必须填写"}]}]},buyerinfoOption:{detail:!1,disabled:!1,labelPosition:"right",labelSuffix:"：",labelWidth:220,gutter:0,menuBtn:!0,submitBtn:!1,emptyBtn:!1,emptyText:"清空",menuPosition:"center",column:[{type:"input",label:"买方名称",span:18,display:!0,prop:"buyerName",required:!0,disabled:!1,rules:[{required:!0,message:"买方名称必须填写"}]},{type:"tree",label:"买方国别",parent:!1,dicData:[],props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"buyerCountry",required:!0,rules:[{required:!0,message:"请选择买方国别"}]},{type:"input",label:"邮政编码",span:12,display:!0,prop:"bpostalCode",rules:[{required:!0,message:"邮政编码必须填写"}],required:!0},{type:"tree",label:"买方性质",parent:!1,props:{label:"dictValue",value:"id"},showAllLevels:!0,dicData:[],cascaderItem:[],span:12,display:!0,prop:"buyerNature",rules:[{required:!0,message:"请选择买方性质",trigger:["blur","change"]}],change:function(t){var r=t.value,n=l()(e,"$refs.buyerinfoForm.DIC.buyerNature"),i=Object(h["e"])(n,r,"id",[]),a="110"!==l()(i,"[0]");["isDevelopmentinstitutions","isTechnology","buyerIndustry"].forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.rules[0].required=a,r.disabled=!a,a?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.buyerinfoForm[t]=null,e.$refs.buyerinfoForm&&e.$refs.buyerinfoForm.validateField(t))}));var o="109"==l()(i,"[0]"),s="107"==l()(i,"[0]");["isAreaenterprises","isConversion","isListedcompany","benterpriseScale"].forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.rules[0].required=o,r.disabled=!o,"isConversion"==t?(r.rules[0].required=o||s,r.disabled=!(o||s),o||s?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.buyerinfoForm[t]=null,e.$refs.buyerinfoForm&&e.$refs.buyerinfoForm.validateField(t))):o?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.buyerinfoForm[t]=null,e.$refs.buyerinfoForm&&e.$refs.buyerinfoForm.validateField(t))}))}},{type:"input",label:"社会统一信用代码",span:12,display:!0,prop:"borganizationCode",rules:[{required:!0,message:"社会统一信用代码必须填写"}]},{type:"tree",label:"买方地区",parent:!1,dicData:[],props:{label:"title",value:"value"},cascaderItem:[],span:12,display:!0,prop:"buyerRegion",rules:[{required:!0,message:"请选择买方地区"}]},{type:"input",label:"注册地址",span:12,display:!0,prop:"buyerAddress",rules:[{required:!0,message:"注册地址必须填写"}]},{type:"tree",label:"是否技术转移机构",dicUrl:"/api/blade-system/dict-biz/child-list?current=1&size=1000&parentId=526",props:{label:"dictValue",value:"dictKey"},parent:!1,span:12,display:!0,prop:"isTechnology",rules:[{required:!0,message:"请选择是否技术转移机构",trigger:["blur","change"]}],change:function(t){var r=t.value,n=["btechnologyName"],i="460108"==r;n.forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.rules[0].required=i,r.disabled=!i,i?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.buyerinfoForm[t]=null,e.$nextTick((function(){e.$refs.buyerinfoForm&&e.$refs.buyerinfoForm.validateField(t)})))}))}},{type:"input",label:"技术转移机构类型",span:12,display:!0,prop:"btechnologyName",rules:[{required:!1,message:"技术转移机构类型必须填写"}]},{type:"radio",label:"是否国家级高新区内企业",dataType:"number",span:12,display:!0,prop:"isAreaenterprises",dicData:[{label:"是",value:1},{label:"否",value:0}],rules:[{required:!0,message:"请选择是否国家级高新区内企业"}],change:function(t){var r=t.value,n=[1].includes(r),i=["buyerPark"];i.forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.rules[0].required=n,r.disabled=!n,n?r.placeholder="请输入"+r.label:(r.placeholder=" ",e.buyerinfoForm[t]=null,e.$refs.buyerinfoForm&&e.$refs.buyerinfoForm.validateField(t))}))}},{type:"input",label:"所属园区",span:12,display:!0,prop:"buyerPark",rules:[{required:!1,message:"所属园区必须填写"}]},{type:"select",label:"机构从事的国民经济行业",dicData:[],props:{label:"dictValue",value:"id"},cascaderItem:[],span:12,display:!0,prop:"buyerIndustry",rules:[{required:!0,message:"机构从事的国民经济行业必须填写"}]},{type:"select",label:"企业规模",dicUrl:"/api/blade-system/dict-biz/dictionary?code=corpScale",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"benterpriseScale",rules:[{required:!0,message:"请选择企业规模"}]},{type:"radio",label:"是否转制科研院所",span:12,display:!0,prop:"isConversion",dicData:[{label:"是",value:1},{label:"否",value:0}],rules:[{required:!0,message:"请选择是否转制科研院所"}]},{type:"radio",label:"是否研发机构",span:12,display:!0,prop:"isDevelopmentinstitutions",dicData:[{label:"是",value:1},{label:"否",value:0}],rules:[{required:!0,message:"请选择是否研发机构"}]},{type:"radio",label:"是否上市公司",dicData:[{label:"是",value:1},{label:"否",value:0}],span:12,display:!0,props:{label:"label",value:"value"},prop:"isListedcompany",rules:[{required:!0,message:"请选择是否上市公司"}],change:function(t){var r=t.value,n=e.findObject(e.buyerinfoOption.column,"bstockCode"),i=1==r;n.rules[0].required=i,n.disabled=1!==r,i?n.placeholder="请输入"+n.label:(n.placeholder=" ",e.buyerinfoForm.bstockCode="",e.$refs.buyerinfoForm.validateField("bstockCode"))}},{type:"input",label:"证券代码",span:12,display:!0,prop:"bstockCode",disabled:!1,rules:[{required:!1,message:"证券代码必须填写"}]},{type:"input",label:"法人代表",span:12,display:!0,prop:"blegalRepresentative",rules:[{required:!0,message:"法人代表必须填写"}]},{type:"input",label:"联系人",span:12,display:!0,prop:"buyerContact",rules:[{required:!0,message:"联系人必须填写"}]},{type:"input",label:"联系电话",span:12,display:!0,prop:"phone",rules:[{required:!0,message:"联系电话必须填写"}]},{type:"input",label:"电子邮件",span:12,display:!0,prop:"buyerEmail",rules:[{required:!1,message:"电子邮件必须填写"}]}]},contractinfoOption:{detail:!1,labelPosition:"right",labelSuffix:"：",labelWidth:220,gutter:0,menuBtn:!0,submitBtn:!1,emptyBtn:!1,emptyText:"清空",menuPosition:"center",column:[{type:"number",label:"成交总金额(元）",span:12,display:!0,prop:"contractTotalAmount",labelTip:"请填写合同成交总金额",labelTipPlacement:"right",append:"元",precision:2,rules:[{required:!0,message:"成交总金额必须填写"},{validator:t,trigger:"blur"}],blur:function(){e.onIsLargeMoney()}},{type:"date",label:"合同签订日期",span:12,display:!0,format:"yyyy-MM-dd",valueFormat:"yyyy-MM-dd",prop:"contractSignedTime",rules:[{required:!0,message:"合同签订日期必须填写"}]},{type:"number",label:"其中技术交易额(元）",span:12,display:!0,prop:"turnover",labelTip:"请填写合同其中技术交易额",labelTipPlacement:"right",append:"元",precision:2,rules:[{required:!0,message:"其中技术交易额必须填写"},{validator:r,trigger:"blur"}]},{type:"date",label:"合同开始日期",span:12,display:!0,format:"yyyy-MM-dd",valueFormat:"yyyy-MM-dd",prop:"contractStartTime",rules:[{required:!0,message:"合同开始日期必须填写"}]},{type:"select",label:"金额支付方式",dicUrl:"/api/blade-system/dict-biz/dictionary?code=t4_3",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,dataType:"number",prop:"payType",rules:[{required:!0,message:"请选择金额支付方式"}]},{type:"date",label:"合同结束日期",span:12,display:!0,format:"yyyy-MM-dd",valueFormat:"yyyy-MM-dd",prop:"contractEndTime",rules:[{required:!0,message:"合同结束日期必须填写"}]},{type:"tree",label:"知识产权",parent:!1,dicUrl:"/api/blade-system/dict-biz/child-list?current=1&size=1000&parentId=529",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:24,display:!0,prop:"knowledge",rules:[{required:!0,message:"请选择知识产权",trigger:"change"}]},{type:"number",label:"含专利数量",span:12,display:!0,disabled:!1,placeholder:"含专利数量",prop:"patentCount",rules:[{required:!1,message:"含专利数量必须填写"}]},{type:"number",label:"含发明专利数量",span:12,disabled:!1,display:!0,prop:"inventionCount",rules:[{required:!1,message:"含发明专利数量必须填写"}]},{type:"number",label:"其中含实用新型专利数量",span:12,display:!0,disabled:!1,prop:"pfumCount",rules:[{required:!1,message:"其中含实用新型专利数量必须填写"}]},{type:"number",label:"其中含外观设计专利数量",span:12,display:!0,disabled:!1,prop:"dpCount",rules:[{required:!1,message:"其中含外观设计专利数量必须填写"}]},{label:"技术领域",type:"tree",parent:!1,dicUrl:"/api/blade-system/dict-biz/child-list?current=1&size=1000&parentId=522",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:24,display:!0,prop:"technicalField",rules:[{required:!0,message:"请选择技术领域"}]},{type:"select",label:"社会经济目标",dicUrl:"/api/blade-system/dict-biz/dictionary?code=t4_12",props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"socialGoals",required:!0,rules:[{required:!0,message:"请选择社会经济目标"}]},{type:"select",label:"技术服务的国民经济行业",dicData:[],props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"nationalIndustry",rules:[{required:!0,message:"请选择技术服务的国民经济行业"}]},{type:"radio",label:"是否关联交易",dicData:[{label:"是",value:1},{label:"否",value:0}],span:24,display:!0,props:{label:"label",value:"value"},prop:"trading",required:!0,labelTip:"关联交易：具有产权关系的技术买方和卖方的技术交易行为。如：子公司与母公司之间的技术交易、外国公司与其在京设立的研发机构之间技术交易等。",labelTipPlacement:"right",rules:[{required:!0,message:"请选择是否关联交易"}]},{type:"input",label:"课题立项名称",cascaderItem:[],span:12,display:!0,props:{label:"label",value:"value"},prop:"projectName",rules:[{required:!0,message:"课题立项名称必须填写"}]},{type:"input",label:"课题立项编号",span:12,display:!0,prop:"projectCode",rules:[{required:!0,message:"课题立项编号必须填写"}]},{type:"input",label:"科技成果登记部门批准登记号",span:12,display:!0,prop:"registrationCode",rules:[{required:!1,message:"科技成果登记部门批准登记号必须填写"}]},{type:"upload",label:"上传技术合同、项目批复和银行凭证",labelTip:"建议将资料合并为pdf上传",labelTipPlacement:"right",tip:"1.上传的文件格式只能是pdf、jpg、gif、png格式，文件数量上限为5个。\n              2.合同类型为技术开发、转让、许可和合同额500万元及以上的技术服务、咨询合同均需上传相关合同附件，否则不予受理。",span:24,display:!0,showFileList:!0,multiple:!0,limit:5,fileSize:1e7,canvasOption:{},props:{label:"originalName",value:"link"},prop:"accessory",loadText:"附件上传中，请稍等",accept:".png,.pdf,.jpg,.gif",propsHttp:{res:"data",name:"originalName",url:"link"},action:"/api/blade-resource/oss/endpoint/put-file-attach",rules:[{required:!0,message:"上传技术合同、项目批复和银行凭证必须填写"}]}]},option:{detail:!1,labelPosition:"right",labelSuffix:"：",labelWidth:220,gutter:0,menuBtn:!0,submitBtn:!1,submitText:"下一步",emptyBtn:!1,emptyText:"清空",menuPosition:"center",column:[{type:"input",label:"项目名称",span:24,display:!0,prop:"projectName",prepend:"",rules:[{required:!0,message:"项目名称必须填写"}]},{type:"radio",label:"合同类型",span:12,display:!0,props:{label:"dictValue",value:"dictKey"},prop:"contractType",dicData:[],rules:[{required:!0,message:"请选择合同类型"}],change:function(){}},{type:"select",label:"合同类别","no-data-text":"请选择合同类型",dicData:[],props:{label:"dictValue",value:"dictKey"},cascaderItem:[],span:12,display:!0,prop:"contractTypeChild",dataType:"number",labelTip:"根据合同类型选择相关合同类别",labelTipPlacement:"right",rules:[{required:!0,message:"请选择合同类别",trigger:"blue"}]},{type:"radio",label:"申报类型",span:12,display:!0,props:{label:"dictValue",value:"dictKey"},labelTip:"个人合同登记只能卖方申请",labelTipPlacement:"right",prop:"declareType",dataType:"number",value:2,dicUrl:"/api/blade-system/dict-biz/dictionary?code=declare_type",dicFlag:!0,border:!1,button:!1,size:"medium",disabled:!1,emptyBtn:!1,rules:[{required:!0,message:"请选择申报类型"}],dicMethod:"get",change:function(){e.onDeclareType()}},{type:"tree",label:"项目计划来源",span:12,display:!0,parent:!1,props:{label:"dictValue",value:"dictKey"},prop:"projectPlanFrom",dicUrl:"/api/blade-system/dict-biz/child-list?current=1&size=100&parentId=520",rules:[{required:!0,message:"请选择项目计划来源"}]},{type:"radio",label:"是否为军民两用合同",span:12,display:!1,props:{label:"label",value:"value"},value:0,prop:"isClassified",dicData:[{label:"是",value:1},{label:"否",value:0}],rules:[{required:!0,message:"请选择是否为军民两用合同"}]},{type:"radio",label:"是否大额合同",span:12,display:!1,props:{label:"label",value:"value"},value:0,prop:"isLarge",dicData:[{label:"是",value:1},{label:"否",value:0}]},{type:"radio",label:"是否涉外合同",span:12,display:!1,props:{label:"label",value:"value"},value:0,prop:"isOutside",dicData:[{label:"是",value:1},{label:"否",value:0}],rules:[{required:!0,message:"请选择是否涉外合同"}]},{type:"tree",label:"登记站",span:12,display:!0,defaultExpandedKeys:["1123598813738675201"],parent:!1,disabled:!1,props:{label:"title",value:"value"},prop:"kiosk",dicData:[],rules:[{required:!0,message:"请选择登记站"}]},{type:"tree",label:"登记处",span:12,display:!1,defaultExpandedKeys:[],parent:!1,dicData:[],prop:"registrationPoint",rules:[{required:!0,message:"请选择登记处"}]},{type:"select",label:"合同申请类型",prop:"type",dataType:"string",display:!1,value:"1",dicData:[{label:"个人合同",value:"0"},{label:"单位合同",value:"1"}]},{type:"select",label:"状态",prop:"contractStatus",dataType:"string",display:!1,value:1,props:{label:"dictValue",value:"dictKey"},dicUrl:"/api/blade-system/dict-biz/dictionary?code=contract_status",rules:[{required:!0,message:"请输入状态",trigger:"blur"}]},{type:"radio",label:"是否申请免税",span:12,display:!1,disabled:!0,dataType:"number",prop:"isFree",value:1,labelTip:"计划外的技术开发、技术转让、技术许可合同才可以申请免税，您需要在合同登记审核通过后在免税申请菜单提交免税申请",labelTipPlacement:"right",rules:[{required:!0,message:"请选择单选框组"}],dicData:[{label:"是",value:1},{label:"否",value:0}]}]},form:{},sellerinfoForm:{},buyerinfoForm:{},contractinfoForm:{accessory:[]},active:1,loading:!1,dicData:[],unitListIsShow:!1,tipsVisible:!1,activeFormName:"",deptTree:[],registrationPoint:{}}},props:{query:{type:Object,default:function(){return{}}}},computed:k(k({},Object(g["b"])(["permission","loginInfo"])),{},{region:function(){var e,t=this.loginInfo.itemcode||"";t=t.substr(2,6);for(var r=0;r<t.length;r++){var n=t.length-r-1;if("0"!==t[n]){e=n;break}}var i=t.slice(0,e+1);return i},contractId:function(){return this.$route.query.contractId||this.query.contractId||null},copyId:function(){return this.$route.query.copyId||this.query.copyId||null},type:function(){return this.$route.query.type||this.query.type||"add"},taskId:function(){return this.$route.query.taskId||this.query.taskId},processInstanceId:function(){return this.$route.query.processInstanceId||this.query.processInstanceId},contractSubject:function(){var e=this.$route.query.contractSubject+"";return"0"!==e&&"1"!==e&&(e=this.query.contractSubject),e},isClassified:function(){var e=+this.$route.query.isClassified;return 0!==e&&1!==e&&(e=+this.query.isClassified),0!==e&&1!==e&&(e=+this.form.isClassified),e}}),watch:{"form.kiosk":{handler:function(e,t){var r=this;this.$nextTick((function(){var n=l()(r,"$refs.form.DIC.kiosk");if(n&&e!=t){var i=Object(h["c"])(n,e),a=l()(i,"parentId",""),o=Object(h["c"])(n,a);r.form.registrationPoint=a,r.registrationPoint=o}}))},deep:!0},"contractinfoForm.knowledge":{handler:function(e){var t=this,r=["040101","040201","040202","040203"].includes(e),n=["patentCount","inventionCount","pfumCount","dpCount"];n.forEach((function(e){var n=t.findObject(t.contractinfoOption.column,e);n.rules[0].required=r,n.disabled=!r,r?n.placeholder="请输入"+n.label:(n.placeholder=" ",t.contractinfoForm[e]=null,t.$refs.contractinfoForm&&t.$refs.contractinfoForm.validateField(e))}))},deep:!0},"form.contractType":{handler:function(){this.onIsLargeMoney(),this.initContractTypeChild()},deep:!0,immediate:!0},"form.projectPlanFrom":{handler:function(e){var t=this,r=l()(this,"$refs.form.DIC.projectPlanFrom",[]),n=Object(h["c"])(r,e,"dictKey"),i=l()(n,"parentId",""),a="1"==i||["01010501"].includes(e),o=["projectName","projectCode","registrationCode"];o.forEach((function(e){var r=t.findObject(t.contractinfoOption.column,e);r.rules[0].required=a,r.disabled=!a,"registrationCode"==e&&(r.rules[0].required=!1),a?r.placeholder="请输入"+r.label:(r.placeholder=" ",t.contractinfoForm[e]=null,t.$nextTick((function(){t.$refs.contractinfoForm&&t.$refs.contractinfoForm.validateField(e)})))}))},deep:!0},"form.type":{handler:function(){var e=this,t=this.findObject(this.sellerinfoOption.column,"sellerNature"),r=this.findObject(this.option.column,"declareType"),n=["slegalRepresentative","sellerContact","sellerAddress","sorganizationCode","sellerIndustry","senterpriseScale"];"0"===this.form.type?(this.form.declareType=2,this.sellerinfoForm.sellerNature="170",t.disabled=!0,r.disabled=!0,n.forEach((function(t){var r=e.findObject(e.sellerinfoOption.column,t);r.display=!1}))):(r.disabled=!1,t.disabled=!1,n.forEach((function(t){var r=e.findObject(e.sellerinfoOption.column,t);r.display=!0})))},deep:!0},"form.contractTypeChild":{handler:function(e){var t=this;this.$nextTick((function(){t.contractinfoForm.contractTypeChild=e}))},deep:!0},"contractinfoForm.contractTypeChild":{handler:function(e){var t=this;this.$nextTick((function(){t.form.contractTypeChild=e}))},deep:!0},"sellerinfoForm.sellerCountry":{handler:function(){this.setIsOutside()},deep:!0},"buyerinfoForm.buyerCountry":{handler:function(){this.setIsOutside()},deep:!0}},methods:{init:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.initData(),e.next=4,Object(u["getUserInfo"])();case 4:if(t=e.sent,r=t.data,this.userInfo=l()(r,"data"),this.unitInfo=l()(r,"data.unitList[0]"),200===l()(r,"code")){e.next=10;break}return e.abrupt("return",this.$alert(l()(r,"msg")||"失败","提示",{confirmButtonText:"确定",callback:function(){}}));case 10:["admin-edit","edit","detail"].includes(this.type)?this.initEditForm():this.initAddForm(),e.next=16;break;case 13:return e.prev=13,e.t0=e["catch"](0),e.abrupt("return",this.$alert(e.t0||"失败","提示",{confirmButtonText:"确定",callback:function(){}}));case 16:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(){return e.apply(this,arguments)}return t}(),initEditForm:function(){"detail"===this.type&&(this.option.detail=this.sellerinfoOption.detail=this.buyerinfoOption.detail=this.contractinfoOption.detail=!0),this.getDetail()},initDeptData:function(){var e=this;return Object(m["getDeptTree"])().then((function(t){var r=e.findObject(e.option.column,"kiosk"),n=l()(t,"data.data",[]);return e.deptTree=n,"add"===e.type||1==l()(e,"form.contractStatus")?(1==e.isClassified?r.dicData=Object(h["k"])(n,"42"):r.dicData=Object(h["k"])(n,e.region),e.$nextTick((function(){e.initSetKiosk(r.dicData)}))):r.dicData=n,n}))},initData:function(){var e=this;Object(b["getChildList"])(1,1e4,"100000").then((function(t){var r=e.findObject(e.sellerinfoOption.column,"sellerCountry"),n=e.findObject(e.buyerinfoOption.column,"buyerCountry");r.dicData=l()(t,"data.data",[]),n.dicData=l()(t,"data.data",[])})),Object(b["getChildList"])(1,1e4,"518").then((function(t){var r=e.findObject(e.option.column,"contractType");r.dicData=l()(t,"data.data",[])})),Object(b["getChildList"])(1,1e4,"517").then((function(t){var r=e.findObject(e.sellerinfoOption.column,"sellerNature"),n=e.findObject(e.buyerinfoOption.column,"buyerNature");r.dicData=l()(t,"data.data",[]),n.dicData=l()(t,"data.data",[])})),Object(b["getChildList"])(1,1e4,"519").then((function(t){var r=e.findObject(e.sellerinfoOption.column,"sellerIndustry"),n=e.findObject(e.buyerinfoOption.column,"buyerIndustry"),i=e.findObject(e.contractinfoOption.column,"nationalIndustry"),a=l()(t,"data.data",[]);r.dicData=n.dicData=i.dicData=a})),Object(y["getLazyTree"])().then((function(t){var r=e.findObject(e.sellerinfoOption.column,"sellerRegion"),n=e.findObject(e.buyerinfoOption.column,"buyerRegion"),i=l()(t,"data.data",[]).filter((function(e){return"0"!=e.value}));r.dicData=i,n.dicData=i}))},initSetKiosk:function(e){var t=this.region,r=this.findObject(this.option.column,"kiosk");if(1!=this.isClassified)if("42"!==t){if(t&&6==t.length){var n=Object(h["c"])(e,t,"region");n&&n.region&&(this.form.kiosk=n.id)}}else{var i="1374534742056976386",a=Object(h["c"])(e,i,"value");a&&a.value&&(this.form.kiosk=i,r.disabled=!0)}else{var o="1374534543330852865",s=Object(h["c"])(e,o,"value");s&&s.value&&(this.form.kiosk=o,r.disabled=!0)}},initWatch:function(){this.$watch("form.declareType",{handler:function(){var e=this;if(this.unitInfo&&"0"!=this.form.type){var t=this.unitInfo;if(2==this.form.declareType){this.setSellerinfoForm(t),this.buyerinfoForm={},this.$refs.buyerinfoForm.resetForm(),this.$nextTick((function(){e.$refs.buyerinfoForm.clearValidate()}));var r=["buyerName","borganizationCode"];r.forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.disabled=!1}));var n=["sellerName","sorganizationCode"];n.forEach((function(t){var r=e.findObject(e.sellerinfoOption.column,t);r.disabled=!0}))}else{this.setBuyerinfoForm(t),this.sellerinfoForm={},this.$refs.sellerinfoForm.resetForm(),this.$nextTick((function(){e.$refs.sellerinfoForm.clearValidate()}));var i=["buyerName","borganizationCode"];i.forEach((function(t){var r=e.findObject(e.buyerinfoOption.column,t);r.disabled=!0}));var a=["sellerName","sorganizationCode"];a.forEach((function(t){var r=e.findObject(e.sellerinfoOption.column,t);r.disabled=!1}))}}},deep:!0})},handleChange:function(e){console.log(e)},handleCancel:function(){"admin-edit"==this.type?this.$emit("close"):(this.$router.$avueRouter.closeTag(),this.$router.go(-1))},setKioskDisabled:function(e){var t=this.findObject(this.option.column,"kiosk");t.disabled=e},setSellerinfoForm:function(e){if(console.log("卖方信息自动填充unitInfo :>> ",e),"0"!=this.form.type)e&&(this.sellerinfoForm={contractId:this.contractId,sellerName:e.unit,sellerCountry:e.nationId||"070142",spostalCode:e.postcode,sellerNature:e.unitCategoryId,sorganizationCode:e.orgcode,sellerRegion:e.areaId,sellerAddress:e.address,isTechnology:e.jszyjg,stechnologyName:e.jszyjgmc,isAreaenterprises:Number(e.isHightech)||0,sellerPark:e.ownedPark,sellerIndustry:-1==e.ownerShip?"":e.ownerShip,isConversion:Number(e.isInstitute)||0,isDevelopmentinstitutions:Number(e.isHightech)||0,isListedcompany:Number(e.isListed)||0,sstockCode:e.certificateNo,slegalRepresentative:e.legalMan,sellerContact:e.linkMan,phone:e.linkManTel,sellerEmail:e.linkManEmail});else{var t=this.userInfo;this.sellerinfoForm={contractId:this.contractId,sellerName:t.name,sellerCountry:t.nationId||"070142"}}},setBuyerinfoForm:function(e){e&&(this.buyerinfoForm={contractId:this.contractId,buyerName:e.unit,buyerCountry:e.nationId||"070142",bpostalCode:e.postcode,buyerNature:e.unitCategoryId,borganizationCode:e.orgcode,buyerRegion:e.areaId,buyerAddress:e.address,isTechnology:e.jszyjg,btechnologyName:e.jszyjgmc,isAreaenterprises:Number(e.isHightech)||0,buyerPark:e.ownedPark,buyerIndustry:-1==e.ownerShip?"":e.ownerShip,isConversion:Number(e.isInstitute)||0,isDevelopmentinstitutions:Number(e.isHightech)||0,isListedcompany:Number(e.isListed)||0,bstockCode:e.certificateNo,blegalRepresentative:e.legalMan,buyerContact:e.linkMan,phone:e.linkManTel,buyerEmail:e.linkManEmail})},setIsOutside:function(){var e=!["0707","070142"].includes(l()(this,"buyerinfoForm.buyerCountry"))||!["0707","070142"].includes(l()(this,"sellerinfoForm.sellerCountry"));this.form.isOutside=Number(e)},validateIsLargeMoneyOrIsOutside:function(){var e=this;return 1==this.isClassified||("admin-edit"==this.type||("1375338592527724546"===this.form.registrationPoint||(1==this.form.isLarge&&"42"!==this.region?(this.$confirm("您的合同为大额合同，请从从政务网省科技厅入口进入，市州不做受理","提交失败",{confirmButtonText:"如何重新选择区划",cancelButtonText:"取消",type:"error",closeOnClickModal:!1,distinguishCancelAndClose:!0}).then((function(){e.codeHelp()})).catch((function(){})),!1):1==this.form.isOutside&&"42"!==this.region?(this.$confirm("您的合同为涉外合同，请从从政务网省科技厅入口进入，市州不做受理","提交失败",{confirmButtonText:"如何重新选择区划",cancelButtonText:"取消",type:"error",closeOnClickModal:!1,distinguishCancelAndClose:!0}).then((function(){e.codeHelp()})).catch((function(){})),!1):1==this.form.isOutside||1==this.form.isLarge||"42"!==this.region||(this.$confirm("您的合同为普通合同，请从您当地县科技经信局、市科技局入口进入，省科技厅不做受理","提交失败",{confirmButtonText:"如何重新选择区划",cancelButtonText:"取消",type:"error",closeOnClickModal:!1,distinguishCancelAndClose:!0}).then((function(){e.codeHelp()})).catch((function(){})),!1))))},closeWindow:function(){function e(){navigator.userAgent.indexOf("MSIE")>0?navigator.userAgent.indexOf("MSIE 6.0")>0?(window.opener=null,window.close()):(window.open("","_top"),window.top.close()):navigator.userAgent.indexOf("Firefox")>0?window.location.href="about:blank ":(window.opener=null,window.open("","_self",""),window.close())}e()},codeHelp:function(){this.$ImagePreview([{thumbUrl:"/img/code-help.png",url:"/img/code-help.png"}],0)},onIsLargeMoney:function(){if("detail"!==this.type&&1!=this.isClassified){var e=this.form.contractType,t=this.contractinfoForm.contractTotalAmount;if(e&&t){console.log("合同类别、成交总金额  :>> ",e,t);var r={"0201":l()(this,"registrationPoint.technicalDevelopment")||l()(this,"deptTree[0].technicalDevelopment")||5e6,"0202":l()(this,"registrationPoint.technicalTransfer")||l()(this,"deptTree[0].technicalTransfer")||5e6,"0203":l()(this,"registrationPoint.technicalConsultation")||l()(this,"deptTree[0].technicalConsultation")||1e7,"0204":l()(this,"registrationPoint.technicalService")||l()(this,"deptTree[0].technicalService")||1e7,"0205":l()(this,"registrationPoint.technicalLicensing")||l()(this,"deptTree[0].technicalLicensing")||5e6},n=t>=r[e];this.form.isLarge=Number(n)}}},initContractTypeChild:function(){var e=this,t=l()(this,"$refs.form.DIC.contractType");if(t){var r=t.find((function(t){return t.dictKey===e.form.contractType})),n=l()(r,"children",[]);this.$nextTick((function(){e.$refs.contractinfoForm.updateDic("contractTypeChild",n),e.$refs.form.updateDic("contractTypeChild",n),e.dicData=n;var t=n.find((function(t){return t.dictKey===e.form.contractTypeChild}));!t&&e.form.contractTypeChild&&(e.form.contractTypeChild="")}))}},onIsFree:function(){var e=this.form,t=e.contractType,r=e.projectPlanFrom,n=["0202","0201","0205"].includes(t)&&["0105"].includes(r);this.form.isFree=Number(n)},onDeclareType:function(){var e=this;this.$nextTick((function(){1===e.form.declareType&&e.$alert("申报类型为买方申请时，卖方需要为湖北省外","提示",{confirmButtonText:"确定",type:"warning",callback:function(){}})}))},tips:function(){1!=this.isClassified&&(this.tipsVisible=!0)},initAddForm:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.form.isClassified=this.isClassified,this.form.type=this.contractSubject,t=!this.unitInfo&&"0"!==this.contractSubject&&1!=this.isClassified,!t){e.next=6;break}return e.abrupt("return",this.$confirm("请先加入单位，点击账户信息菜单，提交加入单位申请，单位管理员审核通过后，可以申请单位合同！","提示",{confirmButtonText:"去设置",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,distinguishCancelAndClose:!0}).then((function(){r.$router.$avueRouter.closeTag(),r.$router.push("/info")})).catch((function(){r.$router.$avueRouter.closeTag(),r.$router.push("/contract")})));case 6:return e.next=8,this.initDeptData();case 8:if(this.tips(),!this.copyId){e.next=11;break}return e.abrupt("return",this.getDetail());case 11:this.initWatch(),2==this.form.declareType?this.setSellerinfoForm(this.unitInfo):this.setBuyerinfoForm(this.unitInfo),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](0),window.console.log(e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(){return e.apply(this,arguments)}return t}(),validate:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,s,c,u,d=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new Promise((function(e){d.$refs.form.validate((function(t,r,n){r(),e({valid:t,done:r,msg:n})}))})),r=new Promise((function(e){d.$refs.sellerinfoForm.validate((function(t,r,n){r(),e({valid:t,done:r,msg:n})}))})),n=new Promise((function(e){d.$refs.buyerinfoForm.validate((function(t,r,n){r(),e({valid:t,done:r,msg:n})}))})),i=new Promise((function(e){d.$refs.contractinfoForm.validate((function(t,r,n){r(),e({valid:t,done:r,msg:n})}))})),e.next=6,Promise.all([t,r,n,i]);case 6:if(a=e.sent,o=a.every((function(e){return e.valid})),s=a.reduce((function(e,t){return k(k({},e),t.msg)}),{}),!o){e.next=14;break}return c=this.validateIsLargeMoneyOrIsOutside(),e.abrupt("return",c&&o);case 14:u=Object.keys(s).map((function(e){return l()(s,"[".concat(e,"][0].message"))})),this.$alert(u.toString(),"带 * 号的字段必须填写",{confirmButtonText:"确定",type:"warning",callback:function(){}});case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleSave:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.loading=!0,1==this.form.contractStatus){e.next=8;break}return e.next=5,this.validate();case 5:if(t=e.sent,t){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,this.saveAll();case 10:r=e.sent,r&&("admin-edit"==this.type?this.$emit("close"):(this.$router.$avueRouter.closeTag(),this.$router.go(-1))),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](0),console.log("error :>> ",e.t0);case 17:return e.prev=17,this.loading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[0,14,17,20]])})));function t(){return e.apply(this,arguments)}return t}(),handleEditSubmit:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.loading=!0,1===t){e.next=8;break}return e.next=5,this.validate();case 5:if(r=e.sent,r){e.next=8;break}return e.abrupt("return");case 8:if(this.form.kiosk){e.next=10;break}return e.abrupt("return",this.$alert("必须选择登记站","提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}));case 10:return e.next=12,this.saveAll();case 12:return n=e.sent,i={taskId:this.taskId,processInstanceId:this.processInstanceId,flag:"ok",contractId:n},e.next=16,Object(p["completeTask"])(i);case 16:a=e.sent,o=a.data,o.success?this.$alert("等待审核，审核进度请查看办件状态，审核结果同时会发送短信到注册手机号","提交成功",{confirmButtonText:"确定",type:"success",callback:function(){s.$router.$avueRouter.closeTag(),s.$router.go(-1)}}):this.$alert(o.msg,"提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](0),window.console.log(e.t0);case 24:return e.prev=24,this.loading=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[0,21,24,27]])})));function t(t){return e.apply(this,arguments)}return t}(),handleSubmit:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.loading=!0,1===t){e.next=8;break}return e.next=5,this.validate();case 5:if(r=e.sent,r){e.next=8;break}return e.abrupt("return");case 8:if(this.form.kiosk){e.next=10;break}return e.abrupt("return",this.$alert("必须选择登记站","提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}));case 10:return e.next=12,this.saveAll();case 12:return n=e.sent,e.next=15,Object(f["startList"])(1,100,{category:"flow_3"});case 15:if(i=e.sent,a=l()(i,"data.data.records[0].id"),a){e.next=19;break}return e.abrupt("return",this.$alert("没有流程ID","提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}));case 19:if(o={processDefinitionId:a,contractId:n,createDept:this.form.kiosk},l()(this,"loginInfo.tyky_saveinfo")||1==this.isClassified){e.next=22;break}return e.abrupt("return",this.$alert("您需要从政务网入口进入，获取tyky_saveinfo失败","提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}));case 22:return s={p2_tyky_zdy:this.loginInfo.p2_tyky_zdy,itemCode:this.loginInfo.itemcode,tyky_saveinfo:this.loginInfo.tyky_saveinfo},e.next=25,Object(p["registrationProcess"])(o,s);case 25:c=e.sent,u=c.data,u.success?this.$alert("等待审核，审核进度请查看办件状态，审核结果同时会发送短信到注册手机号","提交成功",{confirmButtonText:"确定",type:"success",callback:function(){d.$router.go(-1)}}):this.$alert(u.msg,"提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}),e.next=33;break;case 30:e.prev=30,e.t0=e["catch"](0),window.console.log(e.t0);case 33:return e.prev=33,this.loading=!1,e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[0,30,33,36]])})));function t(t){return e.apply(this,arguments)}return t}(),error:function(e){var t=Object.keys(e).map((function(t){return l()(e,"[".concat(t,"][0].message"))}));this.$alert(t.toString(),"带 * 号的字段必须填写",{confirmButtonText:"确定",type:"warning",callback:function(){}})},uploadExceed:function(e,t,r,n){console.log(e,t,r,n),this.$alert("附件最多上传".concat(e,"个"),"提示",{confirmButtonText:"确定",type:"warning",callback:function(){}})},uploadDelete:function(e){var t=l()(e,"url");if(l()(this,"contractinfoForm.accessory")){var r=this.contractinfoForm.accessory.find((function(e){return e.link==t})),n=l()(r,"id");this.contractinfoForm.accessory=this.contractinfoForm.accessory.filter((function(e){return e.link&&e.link!==t})),n&&Object(d["remove"])(n).then((function(e){if(l()(e,!1))return!0}))}},uploadPreview:function(e){var t=e.url,r=t.split(".");if(r=r[r.length-1],"pdf"===r)return window.open("/pdfjs/web/viewer.html?file="+t,"PDF","width:50%;height:50%;top:100;left:100;");var n,i=this.contractinfoForm.accessory.map((function(t,r){return e.url==t.link&&(n=r),{thumbUrl:t.link,url:t.link}}));this.$ImagePreview(i,n)},uploadError:function(e,t){this.$alert("".concat(e,", 文件大小不能超过").concat(t.fileSize),"上传失败",{confirmButtonText:"确定",type:"warning",callback:function(){}})},getDetail:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loading=!0,t=this.contractId||this.copyId,e.next=5,Object(c["getDetail"])(t);case 5:r=e.sent,r=l()(r,"data.data"),n=l()(r,"contractinfo",{}),i=l()(r,"sellerinfo",{}),a=l()(r,"buyerinfo",{}),this.copyId&&(delete r.kiosk,delete r.registrationPoint,delete r.id,delete r.updateTime,delete r.updateUser,delete r.createTime,delete r.createTime,delete r.applyTime,delete r.contractRegistrationNumber,delete r.contractCode,delete n.id,delete a.id,delete i.id,r.contractStatus=1),-1==n.payType&&delete n.payType,"0.00"==n.turnover&&delete n.turnover,"0.00"==n.contractTotalAmount&&delete n.contractTotalAmount;try{n.accessory=JSON.parse(n.accessory)}catch(s){n.accessory=[]}return this.form=this.deepClone(r),this.sellerinfoForm=i,this.buyerinfoForm=a,this.contractinfoForm=n,e.next=21,this.initDeptData();case 21:setTimeout((function(){o.initWatch()}),300),e.next=27;break;case 24:e.prev=24,e.t0=e["catch"](0),window.console.log(e.t0);case 27:return e.prev=27,this.loading=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[0,24,27,30]])})));function t(){return e.apply(this,arguments)}return t}(),getFileData:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d["getList"])();case 3:t=e.sent,r=l()(t,"data.data.records"),this.contractinfoForm.upload=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),window.console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}(),saveAll:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t=l()(this,"$refs.form.DIC.kiosk"),r=Object(h["c"])(t,this.form.kiosk),this.form.registrationPoint=l()(r,"parentId",""),"add"==this.type&&(this.form.registrationUnit=l()(this,"unitInfo.unit"),this.form.registrationUnitId=1==this.form.type?l()(this,"unitInfo.id"):""),n=this.deepClone(this.form),i=this.deepClone(this.buyerinfoForm),a=this.deepClone(this.sellerinfoForm),o=this.deepClone(this.contractinfoForm),o.accessory=JSON.stringify(o.accessory),n.buyerinfo=i,n.sellerinfo=a,n.contractinfo=o,s="add"==this.type?"/api/api/contractlist/saveContractRegistration":"/api/api/contractlist/updateContractRegistration",e.next=16,this.$http({url:s,method:"post",data:n});case 16:if(c=e.sent,u=l()(c,"data.data.id"),!c||!u){e.next=22;break}return e.abrupt("return",u);case 22:return this.$alert("提交失败,请联系管理员","提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}),e.abrupt("return",!1);case 24:e.next=30;break;case 26:return e.prev=26,e.t0=e["catch"](0),this.$alert("提交失败，已暂存，请联系管理员，"+e.t0.toString(),"提交失败",{confirmButtonText:"确定",type:"warning",callback:function(){}}),e.abrupt("return");case 30:case"end":return e.stop()}}),e,this,[[0,26]])})));function t(){return e.apply(this,arguments)}return t}(),handleUnit:function(e){this.activeFormName=e,this.unitListIsShow=!0},handleSelect:function(e){"sellerinfoForm"==this.activeFormName?this.setSellerinfoForm(e):this.setBuyerinfoForm(e),this.unitListIsShow=!1},testSubmitBtn:function(){var e=arguments,t=this;document.onkeydown=function(r){var n=r||event||window.event||e.callee.caller.arguments[0];n&&37==n.keyCode&&(t.isDev=!t.isDev)},this.$once("hook:beforeDestroy",(function(){document.onkeydown=function(){}}))}},created:function(){this.init()},mounted:function(){this.testSubmitBtn()},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},T=O,C=(r("998a"),r("2877")),j=Object(C["a"])(T,n,i,!1,null,"c66604a0",null);t["default"]=j.exports},"207b":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("basic-container",[r("avue-crud",{ref:"crud",attrs:{option:e.option,"table-loading":e.loading,data:e.data,page:e.page,permission:e.permissionList,"before-open":e.beforeOpen},on:{"update:page":function(t){e.page=t},"row-update":e.rowUpdate,"row-save":e.rowSave,"row-del":e.rowDel,"search-change":e.searchChange,"search-reset":e.searchReset,"selection-change":e.selectionChange,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"menu",fn:function(t){var n=t.type,i=t.size,a=t.row;return[r("el-button",{attrs:{icon:"el-icon-plus",size:i,type:n},on:{click:function(t){return e.handleJoin(a)}}},[e._v("选择此单位")])]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1)},i=[],a=(r("8e6e"),r("456d"),r("6762"),r("2fdb"),r("ac6a"),r("bd86")),o=r("5766"),s=r("2f62");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(a["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={data:function(){return{form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},selectionList:[],option:{height:"auto",menuWidth:120,calcHeight:30,tip:!1,searchShow:!0,searchMenuSpan:6,border:!0,index:!0,viewBtn:!0,selection:!0,dialogClickModal:!1,refreshBtn:!1,columnBtn:!1,header:!1,column:[{label:"单位名称",prop:"unit",searchSpan:12,search:!0,rules:[{required:!0,message:"请输入",trigger:"blur"}]},{label:"社会统一信用代码",prop:"orgcode",search:!0,searchSpan:12,searchLabelWidth:130,minWidth:100,rules:[{required:!0,message:"请输入",trigger:"blur"}]},{label:"所在地区",prop:"areaName",rules:[{required:!0,message:"请输入",trigger:"blur"}]},{label:"法人",prop:"legalMan",search:!0,searchSpan:12,rules:[{required:!0,message:"请输入",trigger:"blur"}]},{label:"地址",prop:"address",rules:[{required:!0,message:"请输入",trigger:"blur"}]}]},data:[]}},computed:c(c({},Object(s["b"])(["permission"])),{},{permissionList:function(){return{addBtn:this.vaildData(this.permission.unit_add,!1),viewBtn:this.vaildData(this.permission.unit_view,!1),delBtn:this.vaildData(this.permission.unit_delete,!1),editBtn:this.vaildData(this.permission.unit_edit,!1)}},ids:function(){var e=[];return this.selectionList.forEach((function(t){e.push(t.id)})),e.join(",")}}),methods:{handleJoin:function(e){this.$emit("select",e)},rowSave:function(e,t,r){var n=this;Object(o["add"])(e).then((function(){n.onLoad(n.page),n.$message({type:"success",message:"操作成功!"}),t()}),(function(e){r(),window.console.log(e)}))},rowUpdate:function(e,t,r,n){var i=this;Object(o["update"])(e).then((function(){i.onLoad(i.page),i.$message({type:"success",message:"操作成功!"}),r()}),(function(e){n(),console.log(e)}))},rowDel:function(e){var t=this;this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(o["remove"])(e.id)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"操作成功!"})}))},handleDelete:function(){var e=this;0!==this.selectionList.length?this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(o["remove"])(e.ids)})).then((function(){e.onLoad(e.page),e.$message({type:"success",message:"操作成功!"}),e.$refs.crud.toggleSelection()})):this.$message.warning("请选择至少一条数据")},beforeOpen:function(e,t){var r=this;["edit","view"].includes(t)&&Object(o["getDetail"])(this.form.id).then((function(e){r.form=e.data.data})),e()},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},selectionChange:function(e){this.selectionList=e},selectionClear:function(){this.selectionList=[],this.$refs.crud.toggleSelection()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(o["getList"])(e.currentPage,e.pageSize,Object.assign(r,this.query)).then((function(e){var r=e.data.data;t.page.total=r.total,t.data=r.records,t.loading=!1,t.selectionClear()}))}}},d=u,p=r("2877"),f=Object(p["a"])(d,n,i,!1,null,null,null);t["default"]=f.exports},"21a6":function(e,t,r){(function(r){var n,i,a;(function(r,o){i=[],n=o,a="function"===typeof n?n.apply(t,i):n,void 0===a||(e.exports=a)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){l(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,r){var s=o.URL||o.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?a(l):i(l.href)?n(e,t,r):a(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){a(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,o){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),r);else if(i(e))n(e,r,o);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){a(s)}))}}:function(e,t,r,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,r);var a="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&l||s)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var d=o.URL||o.webkitURL,p=d.createObjectURL(e);i?i.location=p:location.href=p,i=null,setTimeout((function(){d.revokeObjectURL(p)}),4e4)}});o.saveAs=l.saveAs=l,e.exports=l}))}).call(this,r("c8ba"))},"4ff6":function(e,t,r){},"998a":function(e,t,r){"use strict";r("4ff6")},c832:function(e,t,r){(function(t){var r="Expected a function",n="__lodash_hash_undefined__",i=1/0,a="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/,u=/^\./,d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,p=/[\\^$.*+?()[\]{}|]/g,f=/\\(\\)?/g,h=/^\[object .+?Constructor\]$/,m="object"==typeof t&&t&&t.Object===Object&&t,b="object"==typeof self&&self&&self.Object===Object&&self,y=m||b||Function("return this")();function g(e,t){return null==e?void 0:e[t]}function v(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}var w=Array.prototype,k=Function.prototype,O=Object.prototype,T=y["__core-js_shared__"],C=function(){var e=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),j=k.toString,F=O.hasOwnProperty,x=O.toString,I=RegExp("^"+j.call(F).replace(p,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$=y.Symbol,_=w.splice,q=ae(y,"Map"),D=ae(Object,"create"),S=$?$.prototype:void 0,P=S?S.toString:void 0;function N(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function L(){this.__data__=D?D(null):{}}function B(e){return this.has(e)&&delete this.__data__[e]}function E(e){var t=this.__data__;if(D){var r=t[e];return r===n?void 0:r}return F.call(t,e)?t[e]:void 0}function R(e){var t=this.__data__;return D?void 0!==t[e]:F.call(t,e)}function M(e,t){var r=this.__data__;return r[e]=D&&void 0===t?n:t,this}function A(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function z(){this.__data__=[]}function U(e){var t=this.__data__,r=Z(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():_.call(t,r,1),!0}function V(e){var t=this.__data__,r=Z(t,e);return r<0?void 0:t[r][1]}function K(e){return Z(this.__data__,e)>-1}function H(e,t){var r=this.__data__,n=Z(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}function W(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function J(){this.__data__={hash:new N,map:new(q||A),string:new N}}function G(e){return ie(this,e)["delete"](e)}function X(e){return ie(this,e).get(e)}function Q(e){return ie(this,e).has(e)}function Y(e,t){return ie(this,e).set(e,t),this}function Z(e,t){var r=e.length;while(r--)if(fe(e[r][0],t))return r;return-1}function ee(e,t){t=oe(t,e)?[t]:ne(t);var r=0,n=t.length;while(null!=e&&r<n)e=e[ue(t[r++])];return r&&r==n?e:void 0}function te(e){if(!be(e)||le(e))return!1;var t=me(e)||v(e)?I:h;return t.test(de(e))}function re(e){if("string"==typeof e)return e;if(ge(e))return P?P.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}function ne(e){return he(e)?e:ce(e)}function ie(e,t){var r=e.__data__;return se(t)?r["string"==typeof t?"string":"hash"]:r.map}function ae(e,t){var r=g(e,t);return te(r)?r:void 0}function oe(e,t){if(he(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ge(e))||(c.test(e)||!l.test(e)||null!=t&&e in Object(t))}function se(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function le(e){return!!C&&C in e}N.prototype.clear=L,N.prototype["delete"]=B,N.prototype.get=E,N.prototype.has=R,N.prototype.set=M,A.prototype.clear=z,A.prototype["delete"]=U,A.prototype.get=V,A.prototype.has=K,A.prototype.set=H,W.prototype.clear=J,W.prototype["delete"]=G,W.prototype.get=X,W.prototype.has=Q,W.prototype.set=Y;var ce=pe((function(e){e=ve(e);var t=[];return u.test(e)&&t.push(""),e.replace(d,(function(e,r,n,i){t.push(n?i.replace(f,"$1"):r||e)})),t}));function ue(e){if("string"==typeof e||ge(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function de(e){if(null!=e){try{return j.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function pe(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(r);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o),o};return n.cache=new(pe.Cache||W),n}function fe(e,t){return e===t||e!==e&&t!==t}pe.Cache=W;var he=Array.isArray;function me(e){var t=be(e)?x.call(e):"";return t==a||t==o}function be(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ye(e){return!!e&&"object"==typeof e}function ge(e){return"symbol"==typeof e||ye(e)&&x.call(e)==s}function ve(e){return null==e?"":re(e)}function we(e,t,r){var n=null==e?void 0:ee(e,t);return void 0===n?r:n}e.exports=we}).call(this,r("c8ba"))}}]);